# 01_vulnerability_scan.md

## Objective / 目的

- Regularly identify and assess vulnerabilities within the organization’s network and server environments.
- Use common tools such as Nmap and OpenVAS to visualize and evaluate potential risks.
- Feed scan results into the ISMS risk assessment process and implement continuous improvements.
- For hands-on using Nmap, I used pre-configured VMs from TryHackMe. Their walk-through rooms related to this task is below.
- 組織のネットワークおよびサーバ環境における脆弱性を定期的に特定・評価する。
- Nmap、OpenVASなどの一般的なスキャンツールを用いて、リスクレベルを可視化する。
- 結果をISMSのリスクアセスメントに反映し、改善アクションを継続的に行う。
- Nmapを使用するハンズオンについては、TryHackMeの構築済みVMを使用しました。参考URLは以下です。

## Reference / 参考資料
- You  can also check ->
	- (Some room requires subscriptions)
	- Nmap: The Basics https://tryhackme.com/room/nmap
	- Nmap Live Host Discovery https://tryhackme.com/room/nmap01
	- Nmap Basic Port Scans https://tryhackme.com/room/nmap02

---

## Scenario / シナリオ

- As part of the monthly security review, the IT department performs a vulnerability scan across internal networks and critical servers.
- Management requires clear documentation of the scan scope, methodology, and risk expectations.
- After the scan, identified vulnerabilities are categorized by severity, and a mitigation plan is drafted.
- 月次のセキュリティレビューの一環として、社内ネットワークおよび主要サーバ群の脆弱性スキャンを実施します。
- 管理部門からは「どの範囲を対象に、どの程度のリスクを想定しているか」を明確に示すことが求められています。
- スキャン後は、検出された脆弱性をリスクレベル別に整理し、修正計画を提示します。

---

## Lab Steps / 演習ステップ

### 1. Define Scan Scope / スキャン範囲の定義

- Define the internal segment (e.g., 192.168.10.0/24) and key servers within DMZ as scan targets. / 内部セグメント（例：192.168.10.0/24）およびDMZ内の主要サーバを対象とする。
- Use non-intrusive scan modes to avoid production impact. /本番系に影響を与えないよう、非侵入的スキャンモードを採用する。

- A DMZ is a public-facing zone positioned between external and internal networks, while an internal segment is a private network for internal use. / DMZは外部と内部の中間に位置する公開用ゾーンであり、内部セグメントは社内向けの非公開ネットワークです。

- Examples of Internal Segments / 内部セグメントの例
	- Corporate LAN (e.g., 10.0.0.0/16) / 社内LAN（例：10.0.0.0/16）
	- Departmental VLANs (e.g., 192.168.20.0/24) / 部門ごとのVLAN（例：192.168.20.0/24）
	- Private Subnet in AWS (e.g., 10.0.2.0/24) / AWSのプライベートサブネット（例：10.0.2.0/24）
	- Internal-only server zone (e.g., 192.168.30.0/24) / 業務用サーバ専用ゾーン（例：192.168.30.0/24）

- Examples of DMZ Segments / DMZセグメントの例
	- DMZ network (e.g., 172.16.0.0/24) / DMZネットワーク（例：172.16.0.0/24）
	- Public Subnet in AWS (e.g., 10.0.1.0/24) / AWSのパブリックサブネット（例：10.0.1.0/24）
	- Bastion Host zone (e.g., 192.168.40.0/24) / Bastionホスト用ゾーン（例：192.168.40.0/24）
	- Web公開サーバ群（例：203.0.113.0/24）/ Public-facing web server segment (e.g., 203.0.113.0/24)

##### Related to DMZ ... /DMZ番外編
- DMZ-like Architecture in AWS / AWSにおけるDMZ的構成
	- Public Subnet (DMZ role): ALB, NAT Gateway, Bastion Host / パブリックサブネット（DMZ相当）：ALB、NAT Gateway、Bastion Host
	- Private Subnet (Internal role): EC2 App, RDS, Lambda / プライベートサブネット（内部セグメント）：EC2アプリ、RDS、Lambda
	- Traffic control: Security Groups and NACLs / 通信制御：Security Group と NACL

- You can also check ->
	- Nmap の基本的なスキャン技術を学ぶ by LabEx https://labex.io/ja/tutorials/nmap-learn-basic-nmap-scanning-techniques-415929

---

### 2. Port Scan with Nmap / Nmapでのポートスキャン

- This command performs a SYN scan with OS and service version detection, saving results to a text file.
- Scan major ports, detect OS and service versions, and save results.
- 主要ポートを対象にスキャン（OS検出＋サービスバージョン確認）、結果をテキストファイルに保存。

```bash
# bash

sudo nmap -sS -sV -O 192.168.10.0/24 -oN nmap_scan_result.txt
```

- You can also check ->
	- Nmap Cheat Sheet 2025: All the Commands & Flags by StationX https://www.stationx.net/nmap-cheat-sheet/
	- TCP SYN (Stealth) Scan (-sS) https://nmap.org/book/synscan.html
---

### 3. Vulnerability Assessment with OpenVAS / OpenVASによる脆弱性評価

- Update vulnerability feed, start OpenVAS, and create target for scanning. Reports can be exported in HTML/CSV.
- Prepare OpenVAS, sync NVT database, create scan target, and export findings.
- データベースを更新し、スキャンターゲットを作成。
- レポートはHTML/CSVで出力可能。

```bash
# bash

sudo greenbone-nvt-sync
sudo openvas-start
sudo omp -u admin -w yourpassword -T text -iX "<create_target><name>Internal Scan</name><hosts>192.168.10.0/24</hosts></create_target>"
```

- You can also check ->
	- Complete Beginner OpenVAS Vulnerability Scanning Tutorial - Cyber Security // Kali Linux by GetCyber https://www.youtube.com/watch?v=LGh2SetiKaY
---

### 4. Summarize and Report / 結果の整理と報告

- Classify identified vulnerabilities by CVSS score and assign mitigation priorities and deadlines.
- Share the report across relevant departments for coordinated response.
- 発見された脆弱性をCVSSスコア（Critical/High/Medium/Low）で分類。
- 修正方針と対応期限を示し、部門横断でトラッキング。

- You can also check ->
	- CVSSとは？評価基準とスコアの算出方法と見方、深刻度への対応方法を解説 by IWI Security Blog https://www.iwi.co.jp/blog/security/cybersecurity_measures/20240318-cvss/
	- Vulnerability Metrics by NIST https://nvd.nist.gov/vuln-metrics/cvss

---

### 5. Link to ISMS Controls / ISMSとの紐づけ

- Link this process to ISMS control A.12.6 and NIST CSF Detect category DE.CM-8 for continuous improvement.
- Connect scan results to ISMS and NIST CSF monitoring controls.
- ISMS管理策 A.12.6「技術的脆弱性の管理」、NIST CSF Detect（DE.CM-8）に紐づけ。
- スキャン結果をISMSおよびNIST CSF監視管理策と連携し、改善サイクルに反映。

---

## Verification Points / 確認事項

- Scan scope correctly covers internal networks and DMZ servers.
- Nmap scan results are complete and include OS/service version detection.
- OpenVAS feed is up-to-date and reports reflect actual vulnerabilities.
- CVSS-based classification and mitigation priorities are correctly assigned.
- Findings are shared and tracked across responsible departments.
- スキャン範囲が内部ネットワークおよびDMZサーバを正しくカバーしていること。
- Nmapスキャン結果が完全で、OS/サービスバージョン情報を含むこと。
- OpenVASデータベースが最新で、レポートが実際の脆弱性を反映していること。
- CVSSスコアに基づく分類と修正優先度が正しく設定されていること。
- 結果が関係部署に共有され、修正対応がトラッキングされていること。
    
